# History
A distributed and open source history time line tool.  

# Readme CN   

## 起因:  

最近对历史感兴趣，想找一个基于时间线的历史笔记，大致的需求如下：  
1. 可本地编辑，离线使用。  
2. 内容可自由扩展，而不是作者编辑好后大家只读。  
3. 支持在一个坐标轴上同时显示事件以及时间段。 
4. 支持坐标轴缩放。 在不同时间尺度上（万年，世纪，百年，一年，一日） 展示适当的内容。
5. 能识别事件描述中的时间地点人物组织事件，并以此为索引进行关联查找和浏览。  
6. 可以定义多个filter并放置在同一个视图下，如人物朝代及事件，以方便对照查阅。  
7. 多平台浏览编辑以及随身记录。  
8. 最后，布局清晰显示漂亮，自然最好。然而上面的功能优先。  
   
我在网上找了一圈，然而并没有找到理想的软件（或网页）。对于时间线的处理，通常只能显示单点时间或时间段中的一种。无法满足需求。  
所以还是自己动手吧。。。而且虽然很想做网页版的，然而我对web开发不熟。。。人生苦短，还是先py。  

## 设计：

### 几个概念：  
1. TimeAxis: 时间轴，即软件的主要界面。时间轴的布局（layout: 水平或垂直）及位置（align：处于中间或某一边）都可以调整，其两边可以放置Thread显示不同内容。
2. Thread: 历史线索，用以展示历史记录。Thread可以放置在时间轴的两边，可以放置任意个，用以显示不同内容（不同文件或不同filter）。
3. Track: 一个Thread上能显示数个Track（轨道），数量由Thread的宽度和Track最小宽度（可设置）确定。在排布历史记录的时候软件会尽量利用空间并使各个记录不会重叠。如果空间不足，其余的记录会排布到最后一个Track上。
4. Depot: 为了管理方便，我们将所有数据放置在软件目录下的depot目录中，depot目录中的每个文件夹称为一个depot。记录文件可以按语言或内容分类放置在不同的depot（文件夹）中。
4. Index: 软件的设计上考虑到在线和分布式的使用场景。由于空间和带宽的限制，展现给客户的不可能是完整的内容。因此软件支持将记录的时间和摘要提取出来作为索引，并指向真正内容。当用户需要查看详情的时候，主要内容才会被加载。
5. Filter: 对于已经加载的内容而言，我们可以对其中的内容进行选择展示。主要应用在PC和移动端，以及index的编辑上。由于index包含的信息过少，所以网页及分布场景我们难以使用filter。这点或许会在以后改进。
  
### 界面说明：  
* 从main.py运行，需要python3 + pyqt5支持
* 坐标轴界面可以按左键沿轴向拖动或鼠标滚轮滑动。CTRL+滚轮可以缩放时间轴。
* 在主界面上任意地方点击右键会弹出菜单，如果鼠标下面没有Thread，可以添加一个新的Thread。
* 在Thread上点击右键可以为其载入文件，depot或打开filter。注意filter只能应用于已载入的记录（File -> Load xxx），而Load Index及Load File同时会载入对应的记录。
* 此外可以调整Track宽度，删除当前Thread，以及在此Thread左右打开一个新的Thread。
* 在展示的Record上双击，可以打开详细信息及编辑器。当前软件在编辑内容后可以不会实时更新，这点会在以后的版本改进。
* File菜单下的Load File可以将单个文件载入内存中，载入后的信息可以通过Filter进行筛选查看。其中Load All会载入depot下所有内容，时间会比较久，界面可能存在长时间不响应的情况。这点也会在后续版本进行改进。
* View菜单下的Historical Record Editor可以打开编辑器。编辑器的左侧下拉列表选择depot，列表选择文件，右侧编辑。点击Apply后保存到文件。
* View菜单下的History Filter Editor可以打开Filter及Index编辑器，根据选择的Filter生成对应的index。
  
  
* 关于存储：我希望编辑起来就像写文本文件一样自然，而且对于共同编辑以及Review合并而言，无疑文本文件是最好的选择。数据库虽然可能检索方便，但总归够不直观。
* 关于格式：对于XML这种复杂的格式我向来深恶痛绝，JSON是简单，但仍然不够自然。我需要的不过是故事般的文本，最多打上一些便于检索的标签。于是我搞了一个LabelTags的格式。
> 最基本的形式：label: tag1, tag2, tag3, ...\n  
> label与tags之间用冒号【:】分隔，以换行结尾。多个tag之间以逗号【,】分隔  
> 如果需要显得紧凑，也可以使用分号【;】结尾：label1: tag1, tag2; label2: tag3, tag4; ...  
> 支持以【#】开头并以换行【\n】结尾的注释  
> label及tag可以用三个双引号【"""】包围，以避免其中含有的字符影响文件解析  
* 一个历史事件的记录称为一个Historical Record，简称record  
* 为了方便record之间的关联和检索，程序中引入了“五要素”的概念：时间(time)，地点(location)，人物(people)，组织(organization)，事件(event)。理想情况下，所有的要素应从正文中自动提取（但现阶段做不到）。  
>  对于event，为了方便展示，额外加入标题(title)和摘要(brief)的字段。
* 为了进一步扩展描述能力，以及能在一个文件中写多个record，所以额外引入“focus label”的概念。
> 以\[START\]作为label来标记focus label并作为一个record的开始，直到focus label的出现作为该record的结束。
> 可以用一个record来描述某个要素，系统可以借助这个record更精确地识别文本中的各个要素，并且这种要素更容易被filter。
> 以下record就描述了一个名为Sleepy大人物
>>  \[START\]: people  
>>  event: Sleepy is handsome  
>>  people: Sleepy  
* 由于考虑到在线应用，因此将数据分为index和depot。
> 使用indexer.py将depot中的数据抽取成标准的index形式，其中的内容足够viewer展示。
> 在用户需要查看具体内容时，viewer会根据index中的source项去加载对应的文件。
> 采用这种设计，我们可以直接利用github作为我们的depot。一切计算在客户端进行，不需要占用服务器的空间及算力。
> 此外，用户可以使用他们自己的depot，而不会被软件的作者或网站的作者所限制。
> 但随之而来的问题是：
> 1. record更新后viewer无法实时更新（需要先更新index）
> 2. 服务器做实时查询比较困难（当然也可以根据查询生成一个index并传回前端）

## Python版本的使用

* 运行环境：python3 + pyqt5  

* main.py

程序主入口，主界面为时间轴，两侧可以添加Thread

* editor.py：直接运行打开编辑器  
> 编辑器左侧为depot和文件browser  
> 右侧上方的combobox选择需要编辑的record  
> 点击"New Record"在当前文件中增加一个record  
> 点击"New File"新建一个文件并在这个文件中增加一个record  
> 任何更改在点击"apply"后生效  
> 为防止bug导致文件损坏（一般不会），建议编辑一段后及时git add  
> 修改完record后记得更新Index  
* viewer.py：直接运行打开viewer  
> 鼠标拖动或滚轮移动时间轴  
> CTRL + 滚轮更改坐标轴的scale  
> 双击一个record查看具体内容  
> 当前未完成状态下默认只有一个历史线索(thread)  
* indexer.py：直接运行默认为“China_CN”depot生成index  

## 关于开放协作（虽然应该没人会响应...）  

* 有兴趣的同志们可以fork一份代码，在自己的repo上提交你的record后，再向我提交一个pull request。在record中可以增加一个名为author的label，并填上你的名字。  
* 不知道有没有高手可以做一个网页版本的viewer...  

-------------------------------------------------------------------------------------------------

# Readme EN  

TODO  


-------------------------------------------------------------------------------------------------

# Dev Note:  

## DONE

(DONE) | 试用了一下，有几个需要改进的地方：  
(DONE) | 1.编辑界面需要加入“在本文件中新建”及“新建到一个新的文件”功能  
(DONE) | 2.编辑界面可以选择倾向，可以是时间、地点、人物、组织、事件  
(DONE) | 	所选择的内容为必填项  
(DONE) | 3.编辑界面需要加入“锁定”功能，锁定的项目在新建的时候不会被消除  
(DONE) | 统一LabelTag、Index及event  
(DONE) | Editor中加入depot与文件浏览界面  
(DONE) | depot的分类和选择  
(DONE) | 如何处理相同时间（约）中发生的事，如前12世纪廪辛康丁，武乙，文丁等人发动的各场战争  
(DONE) | 文件重命名
(DONE) | 文event combobox显示时间并按时间排序  

## TODO:

Thread Config界面优化（Load，Check）
Thread放在坐标轴左边

如何优化一年内多起事件的显示（重叠的问题）  
同一时代人物太多经常导致显示空间不足，如何处理  
  
Thread编辑  
    界面支持配置1-10个thread，包括enable，focus label，depot，filter  
    界面根据用户配置生成不同的Index供不同的thread载入  
    在LabelTags层面上支持filter功能  
    
合并文件功能：可以将多个小文件合并成一个大文件  

五要素外其它tags的编辑功能  
viewer可以直接载入event而不仅仅只是index  
改变窗口大小的操作会触发mouse event的问题  

坐标轴的改进：  
	优化zoom in和zoom out功能使之更加自然  
	main scale为年时sub scale应为月（12格），同理月之下为周，周之下为日，日之下为时  
	更好的取整及显示时间单位  

多thread的界面设计  
	使用label:tags格式作为filter  
	可以将filter保存为预设值或通过URL传递  
	可以让用户方便的预设自定义filter  
	嵌入绘图中会增加难度，可以考虑在绘图之外使用控件编辑  

## IDEA：  

对于一些时间比较暧昧事件的处理（特别是远古时代的事件）  
对于一些使用相对时间的事件的处理  
可以使用不同的时间基准（公元，万历，民国等）  

如何使index更小，却能索引更多内容  
或者在这种极小index的设计下，如何检索更多内容  
网页端的展示界面（js）  


使用自然语言处理算法提取四要素tag  
使用类似的方法将提取出来的时间数字化  



